<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025入学信息查询</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        neutral: '#64748B',
                        light: '#F8FAFC',
                        dark: '#1E293B'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            .input-focus {
                @apply focus:ring-2 focus:ring-primary/50 focus:border-primary focus:outline-none;
            }
            .btn-hover {
                @apply hover:shadow-lg hover:-translate-y-0.5 transition-all duration-300;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-dark">
    <!-- 顶部导航 -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-graduation-cap text-primary text-2xl"></i>
                <h1 class="text-xl md:text-2xl font-bold text-primary">2025入学信息查询</h1>
            </div>
            <div class="flex items-center space-x-4">
                <div class="hidden md:block text-neutral text-sm">
                    <p>枣庄市第四十一中学北校区</p>
                </div>
                <!-- 后台管理入口 -->
                <button id="admin-entry" class="text-neutral hover:text-primary transition-colors text-sm flex items-center">
                    <i class="fa fa-cog mr-1"></i>管理入口
                </button>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- 查询区域 -->
        <section id="query-section" class="bg-white rounded-xl p-6 md:p-8 card-shadow mb-8 transform transition-all duration-500">
            <h2 class="text-xl md:text-2xl font-bold mb-6 text-center text-dark border-b pb-3">学生信息查询</h2>
            
            <form id="query-form" class="space-y-4 md:space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                    <div>
                        <label for="student-name" class="block text-sm font-medium text-neutral mb-1">学生姓名</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-neutral">
                                <i class="fa fa-user"></i>
                            </span>
                            <input type="text" id="student-name" 
                                class="pl-10 w-full rounded-lg border border-gray-300 py-3 input-focus"
                                placeholder="请输入学生姓名">
                        </div>
                    </div>
                    
                    <div>
                        <label for="id-card" class="block text-sm font-medium text-neutral mb-1">身份证号</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-neutral">
                                <i class="fa fa-id-card"></i>
                            </span>
                            <input type="text" id="id-card" 
                                class="pl-10 w-full rounded-lg border border-gray-300 py-3 input-focus"
                                placeholder="请输入身份证号">
                        </div>
                    </div>
                </div>
                
                <div class="text-center pt-2">
                    <button type="submit" class="bg-primary text-white font-medium py-3 px-8 rounded-lg btn-hover w-full md:w-auto">
                        <i class="fa fa-search mr-2"></i>查询
                    </button>
                </div>
            </form>
        </section>
        
        <!-- 结果区域 (初始隐藏) -->
        <section id="result-section" class="hidden bg-white rounded-xl p-6 md:p-8 card-shadow mb-8 transition-all duration-500">
            <div class="flex justify-between items-center mb-6 border-b pb-3">
                <h2 class="text-xl md:text-2xl font-bold text-dark">查询结果</h2>
                <button id="reset-btn" class="text-neutral hover:text-primary transition-colors">
                    <i class="fa fa-refresh mr-1"></i>重新查询
                </button>
            </div>
            
            <div id="result-content" class="space-y-4 md:space-y-6">
                <!-- 结果将通过JavaScript动态填充 -->
            </div>
            
            <!-- 校服征订选项 -->
            <div class="mt-8 p-4 bg-light rounded-lg border border-gray-200">
                <h3 class="font-semibold text-dark mb-3">校服征订征求家长意见选项</h3>
                <div class="space-y-3">
                    <div class="flex items-center">
                        <input type="radio" id="option1" name="uniform-option" value="同意购买校服（夏装，春秋装，冬装）" class="w-4 h-4 text-primary" checked>
                        <label for="option1" class="ml-2 text-neutral">同意购买校服（夏装，春秋装，冬装）</label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" id="option2" name="uniform-option" value="同意购买校服（夏装，春秋装）" class="w-4 h-4 text-primary">
                        <label for="option2" class="ml-2 text-neutral">同意购买校服（夏装，春秋装）</label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" id="option3" name="uniform-option" value="不同意购买校服" class="w-4 h-4 text-primary">
                        <label for="option3" class="ml-2 text-neutral">不同意购买校服</label>
                    </div>
                </div>
            </div>
            
            <!-- 提交按钮 -->
            <div class="mt-8 text-center">
                <button id="submit-btn" class="bg-secondary text-white font-medium py-3 px-8 rounded-lg btn-hover w-full md:w-auto">
                    <i class="fa fa-check mr-2"></i>确认提交
                </button>
            </div>
        </section>
        
        <!-- 未找到结果提示 (初始隐藏) -->
        <section id="not-found" class="hidden bg-white rounded-xl p-8 text-center card-shadow mb-8">
            <div class="text-neutral text-5xl mb-4">
                <i class="fa fa-search"></i>
            </div>
            <h2 class="text-xl font-bold mb-2">未找到相关信息</h2>
            <p class="text-neutral mb-6">请检查您输入的姓名和身份证号是否正确</p>
            <button id="try-again-btn" class="bg-primary text-white font-medium py-2 px-6 rounded-lg btn-hover">
                重新尝试
            </button>
        </section>
        
        <!-- 支付界面 (初始隐藏) -->
        <section id="payment-section" class="hidden bg-white rounded-xl p-6 md:p-8 card-shadow transition-all duration-500">
            <div class="text-center mb-6">
                <h2 class="text-xl md:text-2xl font-bold text-dark mb-2">缴费确认</h2>
                <p class="text-neutral">请完成缴费以确认报到信息</p>
            </div>
            
            <div class="flex flex-col items-center justify-center p-6 border-2 border-dashed border-gray-200 rounded-lg max-w-md mx-auto">
                <h3 class="text-lg font-semibold text-dark mb-4">请扫码缴费</h3>
                <div class="bg-white p-4 shadow-md rounded-lg mb-4">
                    <img src="https://raw.githubusercontent.com/unsky2003/chaxun/refs/heads/main/jiaofei2.png" 
                         alt="缴费二维码" 
                         class="w-64 h-64 object-contain">
                </div>
                <p class="text-sm text-neutral text-center">
                    请使用微信或支付宝扫描上方二维码完成缴费<br>
                    缴费完成后即确认报到信息
                </p>
            </div>
            
            <div class="mt-8 text-center">
                <button id="back-btn" class="bg-neutral text-white font-medium py-3 px-8 rounded-lg btn-hover w-full md:w-auto">
                    <i class="fa fa-arrow-left mr-2"></i>返回
                </button>
            </div>
        </section>
        
        <!-- 管理界面 (初始隐藏) -->
        <section id="admin-section" class="hidden bg-white rounded-xl p-6 md:p-8 card-shadow mb-8 transition-all duration-500">
            <div class="flex justify-between items-center mb-6 border-b pb-3">
                <h2 class="text-xl md:text-2xl font-bold text-dark">后台管理</h2>
                <button id="exit-admin-btn" class="text-neutral hover:text-primary transition-colors">
                    <i class="fa fa-sign-out mr-1"></i>退出管理
                </button>
            </div>
            
            <!-- 管理员登录 -->
            <div id="admin-login" class="space-y-4">
                <h3 class="text-lg font-semibold">管理员登录</h3>
                <div>
                    <label for="admin-password" class="block text-sm font-medium text-neutral mb-1">管理员密码</label>
                    <input type="password" id="admin-password" 
                        class="w-full rounded-lg border border-gray-300 py-3 input-focus"
                        placeholder="请输入管理员密码">
                </div>
                <button id="login-btn" class="bg-primary text-white font-medium py-3 px-8 rounded-lg btn-hover w-full md:w-auto">
                    <i class="fa fa-lock mr-2"></i>登录
                </button>
            </div>
            
            <!-- 管理内容 (初始隐藏) -->
            <div id="admin-content" class="hidden space-y-6">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-semibold">查询记录</h3>
                    <button id="download-data-btn" class="bg-secondary text-white font-medium py-2 px-4 rounded-lg btn-hover text-sm">
                        <i class="fa fa-download mr-1"></i>下载数据
                    </button>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral uppercase tracking-wider">序号</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral uppercase tracking-wider">学生姓名</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral uppercase tracking-wider">身份证号</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral uppercase tracking-wider">校服选择</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral uppercase tracking-wider">查询时间</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral uppercase tracking-wider">状态</th>
                            </tr>
                        </thead>
                        <tbody id="query-records" class="bg-white divide-y divide-gray-200">
                            <!-- 记录将通过JavaScript动态填充 -->
                        </tbody>
                    </table>
                </div>
                
                <div id="no-records" class="hidden text-center py-8 text-neutral">
                    暂无查询记录
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-dark text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center text-sm">
            <p>© 2025 枣庄市第四十一中学北校区 版权所有</p>
            <p class="mt-1 text-gray-400">如有疑问，请联系学校办公室</p>
        </div>
    </footer>

    <script>
        // 页面元素
        const queryForm = document.getElementById('query-form');
        const resultSection = document.getElementById('result-section');
        const notFoundSection = document.getElementById('not-found');
        const paymentSection = document.getElementById('payment-section');
        const adminSection = document.getElementById('admin-section');
        const adminLogin = document.getElementById('admin-login');
        const adminContent = document.getElementById('admin-content');
        const resultContent = document.getElementById('result-content');
        const queryRecords = document.getElementById('query-records');
        const noRecords = document.getElementById('no-records');
        
        // 按钮元素
        const resetBtn = document.getElementById('reset-btn');
        const tryAgainBtn = document.getElementById('try-again-btn');
        const submitBtn = document.getElementById('submit-btn');
        const backBtn = document.getElementById('back-btn');
        const adminEntryBtn = document.getElementById('admin-entry');
        const exitAdminBtn = document.getElementById('exit-admin-btn');
        const loginBtn = document.getElementById('login-btn');
        const downloadDataBtn = document.getElementById('download-data-btn');
        
        // 输入框元素
        const studentNameInput = document.getElementById('student-name');
        const idCardInput = document.getElementById('id-card');
        const adminPasswordInput = document.getElementById('admin-password');
        
        // 学生数据和查询记录
        let studentsData = [];
        let queryHistory = JSON.parse(localStorage.getItem('queryHistory')) || [];
        const ADMIN_PASSWORD = 'admin123'; // 管理员密码，实际应用中应加密存储
        
        // 加载学生数据
        async function loadStudentsData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/unsky2003/chaxun/refs/heads/main/students_2000.json');
                if (!response.ok) {
                    throw new Error('数据加载失败');
                }
                studentsData = await response.json();
                console.log('数据加载成功');
            } catch (error) {
                console.error('加载数据时出错:', error);
                alert('数据加载失败，请稍后再试');
            }
        }
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', () => {
            loadStudentsData();
            setupEventListeners();
        });
        
        // 设置所有事件监听器
        function setupEventListeners() {
            // 表单提交事件
            queryForm.addEventListener('submit', (e) => {
                e.preventDefault();
                queryStudent();
            });
            
            // 重置按钮事件
            resetBtn.addEventListener('click', resetForm);
            
            // 再试一次按钮事件
            tryAgainBtn.addEventListener('click', resetForm);
            
            // 提交按钮事件
            submitBtn.addEventListener('click', handleSubmit);
            
            // 返回按钮事件
            backBtn.addEventListener('click', showResultSection);
            
            // 管理员入口事件
            adminEntryBtn.addEventListener('click', showAdminSection);
            
            // 退出管理事件
            exitAdminBtn.addEventListener('click', exitAdminSection);
            
            // 管理员登录事件
            loginBtn.addEventListener('click', adminLoginHandler);
            
            // 下载数据事件
            downloadDataBtn.addEventListener('click', downloadQueryData);
            
            // 校服选项变更时更新记录
            document.querySelectorAll('input[name="uniform-option"]').forEach(radio => {
                radio.addEventListener('change', updateUniformChoiceInHistory);
            });
        }
        
        // 查询学生信息
        function queryStudent() {
            const name = studentNameInput.value.trim();
            const idCard = idCardInput.value.trim();
            
            // 简单验证
            if (!name || !idCard) {
                alert('请输入姓名和身份证号');
                return;
            }
            
            // 查找学生
            const student = studentsData.find(s => 
                s['学生姓名'] === name && s['身份证号'] === idCard
            );
            
            if (student) {
                displayResult(student);
                showResultSection();
                hideNotFoundSection();
                
                // 记录查询历史（不包含终端信息）
                const queryTime = new Date().toLocaleString();
                
                // 检查是否已有相同学生的未提交记录，有则更新时间，无则添加新记录
                const existingRecordIndex = queryHistory.findIndex(r => 
                    r.studentName === name && r.idCard === idCard && !r.submitted
                );
                
                if (existingRecordIndex >= 0) {
                    // 更新现有未提交记录的查询时间
                    queryHistory[existingRecordIndex].queryTime = queryTime;
                } else {
                    // 添加新的查询记录
                    queryHistory.push({
                        id: Date.now(),
                        studentName: name,
                        idCard: idCard,
                        uniformChoice: document.querySelector('input[name="uniform-option"]:checked').value,
                        queryTime: queryTime,
                        submitted: false
                    });
                }
                
                saveQueryHistory();
                // 如果管理员已登录，实时更新记录显示
                if (!adminContent.classList.contains('hidden')) {
                    displayQueryRecords();
                }
            } else {
                hideResultSection();
                showNotFoundSection();
            }
        }
        
        // 更新历史记录中的校服选择
        function updateUniformChoiceInHistory() {
            const name = studentNameInput.value.trim();
            const idCard = idCardInput.value.trim();
            if (!name || !idCard) return;
            
            const selectedOption = document.querySelector('input[name="uniform-option"]:checked').value;
            
            // 更新当前学生的校服选择
            const lastRecordIndex = queryHistory.findIndex(r => 
                r.studentName === name && r.idCard === idCard && !r.submitted
            );
            
            if (lastRecordIndex >= 0) {
                queryHistory[lastRecordIndex].uniformChoice = selectedOption;
                saveQueryHistory();
                // 如果管理员已登录，实时更新记录显示
                if (!adminContent.classList.contains('hidden')) {
                    displayQueryRecords();
                }
            }
        }
        
        // 显示查询结果
        function displayResult(student) {
            resultContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <p class="text-sm text-neutral">学生姓名</p>
                        <p class="font-medium">${student['学生姓名']}</p>
                    </div>
                    <div>
                        <p class="text-sm text-neutral">身份证号</p>
                        <p class="font-medium">${student['身份证号']}</p>
                    </div>
                </div>
                
                <!-- 重点显示报到编号 -->
                <div class="p-4 bg-primary/10 rounded-lg border border-primary/20">
                    <p class="text-sm text-neutral">报到编号</p>
                    <p class="text-2xl font-bold text-primary">${student['报到编号']}</p>
                </div>
                
                <div>
                    <p class="text-sm text-neutral">录取情况</p>
                    <p class="font-medium">${student['录取情况']}</p>
                </div>
                
                <div>
                    <p class="text-sm text-neutral">报到时间</p>
                    <p class="font-medium">${student['报到时间']}</p>
                </div>
                
                <div class="p-3 bg-amber-50 rounded-lg border border-amber-100">
                    <p class="text-sm text-neutral">特别提醒</p>
                    <p class="font-medium text-amber-700">${student['特别提醒']}</p>
                </div>
            `;
        }
        
        // 处理提交操作
        function handleSubmit() {
            const name = studentNameInput.value.trim();
            const idCard = idCardInput.value.trim();
            const selectedOption = document.querySelector('input[name="uniform-option"]:checked').value;
            
            // 更新最后一条查询记录的校服选择和提交状态
            const lastRecordIndex = queryHistory.findIndex(r => 
                r.studentName === name && r.idCard === idCard && !r.submitted
            );
            
            if (lastRecordIndex >= 0) {
                queryHistory[lastRecordIndex].uniformChoice = selectedOption;
                queryHistory[lastRecordIndex].submitted = true;
                queryHistory[lastRecordIndex].submitTime = new Date().toLocaleString();
                saveQueryHistory();
                
                // 如果管理员已登录，实时更新记录显示
                if (!adminContent.classList.contains('hidden')) {
                    displayQueryRecords();
                }
            }
            
            showPaymentSection();
        }
        
        // 重置表单
        function resetForm() {
            queryForm.reset();
            showQuerySection();
            hideResultSection();
            hideNotFoundSection();
            hidePaymentSection();
        }
        
        // 管理员登录处理
        function adminLoginHandler() {
            const password = adminPasswordInput.value.trim();
            
            if (password === ADMIN_PASSWORD) {
                adminPasswordInput.value = '';
                adminLogin.classList.add('hidden');
                adminContent.classList.remove('hidden');
                displayQueryRecords();
            } else {
                alert('密码错误，请重试');
                adminPasswordInput.focus();
            }
        }
        
        // 显示查询记录
        function displayQueryRecords() {
            if (queryHistory.length === 0) {
                queryRecords.innerHTML = '';
                noRecords.classList.remove('hidden');
                return;
            }
            
            noRecords.classList.add('hidden');
            queryRecords.innerHTML = '';
            
            // 按查询时间倒序显示
            const sortedHistory = [...queryHistory].sort((a, b) => new Date(b.queryTime) - new Date(a.queryTime));
            
            sortedHistory.forEach((record, index) => {
                const row = document.createElement('tr');
                row.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                
                // 状态显示
                let statusText = '已查询';
                let statusClass = 'text-neutral';
                if (record.submitted) {
                    statusText = '已提交';
                    statusClass = 'text-green-600';
                }
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral">${index + 1}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">${record.studentName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral">${maskIdCard(record.idCard)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral">${record.uniformChoice || '未选择'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral">${record.queryTime}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${statusClass}">${statusText}</td>
                `;
                
                queryRecords.appendChild(row);
            });
        }
        
        // 身份证号脱敏处理
        function maskIdCard(idCard) {
            if (!idCard) return '';
            return idCard.substring(0, 6) + '********' + idCard.substring(14);
        }
        
        // 下载查询数据
        function downloadQueryData() {
            if (queryHistory.length === 0) {
                alert('没有可下载的查询数据');
                return;
            }
            
            // 转换为CSV格式
            let csvContent = "序号,学生姓名,身份证号,校服选择,查询时间,提交状态,提交时间\n";
            
            queryHistory.forEach((record, index) => {
                csvContent += `${index + 1},${record.studentName},${record.idCard},${record.uniformChoice},${record.queryTime},${record.submitted ? '已提交' : '未提交'},${record.submitTime || ''}\n`;
            });
            
            // 创建下载链接
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `入学查询记录_${new Date().toLocaleDateString()}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // 保存查询历史到本地存储
        function saveQueryHistory() {
            localStorage.setItem('queryHistory', JSON.stringify(queryHistory));
        }
        
        // 显示查询区域
        function showQuerySection() {
            document.getElementById('query-section').classList.remove('hidden');
        }
        
        // 显示结果区域
        function showResultSection() {
            resultSection.classList.remove('hidden');
            hidePaymentSection();
        }
        
        // 隐藏结果区域
        function hideResultSection() {
            resultSection.classList.add('hidden');
        }
        
        // 显示未找到结果
        function showNotFoundSection() {
            notFoundSection.classList.remove('hidden');
        }
        
        // 隐藏未找到结果
        function hideNotFoundSection() {
            notFoundSection.classList.add('hidden');
        }
        
        // 显示支付界面
        function showPaymentSection() {
            paymentSection.classList.remove('hidden');
            resultSection.classList.add('hidden');
        }
        
        // 隐藏支付界面
        function hidePaymentSection() {
            paymentSection.classList.add('hidden');
        }
        
        // 显示管理员界面
        function showAdminSection() {
            hideResultSection();
            hideNotFoundSection();
            hidePaymentSection();
            document.getElementById('query-section').classList.add('hidden');
            adminSection.classList.remove('hidden');
            adminLogin.classList.remove('hidden');
            adminContent.classList.add('hidden');
            adminPasswordInput.value = '';
        }
        
        // 退出管理员界面
        function exitAdminSection() {
            adminSection.classList.add('hidden');
            showQuerySection();
        }
    </script>
</body>
</html>
